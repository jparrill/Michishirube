{{define "content"}}
<div class="dashboard">



    <!-- Tasks List -->
    <div class="tasks-container">
        {{if .Tasks}}
            {{range .Tasks}}
            <div class="task-row" data-task-id="{{.ID}}">
                <div class="task-main">
                    <div class="task-priority">
                        {{if eq (string .Priority) "critical"}}üî¥{{end}}
                        {{if eq (string .Priority) "high"}}üî∫{{end}}
                        {{if eq (string .Priority) "normal"}}üü∞{{end}}
                        {{if eq (string .Priority) "minor"}}üîΩ{{end}}
                    </div>
                    <div class="task-content">
                        <div class="task-title-row">
                            <div class="task-left-info">
                                <a href="/task/{{.ID}}" class="task-link">
                                    <span class="jira-id">[{{.JiraID}}]</span>
                                    <span class="title-text">{{.Title}}</span>
                                </a>
                                {{if .Tags}}
                                    <div class="task-tags">
                                        {{range .Tags}}<span class="tag">{{.}}</span>{{end}}
                                    </div>
                                {{end}}
                            </div>
                            <div class="task-indicators">
                                {{if .Comments}}
                                    <a href="/task/{{.ID}}#comments" class="indicator-badge indicator-link">üí¨ {{len .Comments}}</a>
                                {{end}}
                                {{$prLinks := slice}}
                                {{$slackLinks := slice}}
                                {{$jiraLinks := slice}}
                                {{$docsLinks := slice}}
                                {{$otherLinks := slice}}
                                {{range .Links}}
                                    {{if eq (string .Type) "pull_request"}}{{$prLinks = append $prLinks .}}{{end}}
                                    {{if eq (string .Type) "slack_thread"}}{{$slackLinks = append $slackLinks .}}{{end}}
                                    {{if eq (string .Type) "jira_ticket"}}{{$jiraLinks = append $jiraLinks .}}{{end}}
                                    {{if eq (string .Type) "documentation"}}{{$docsLinks = append $docsLinks .}}{{end}}
                                    {{if eq (string .Type) "other"}}{{$otherLinks = append $otherLinks .}}{{end}}
                                {{end}}
                                {{if gt (len $prLinks) 0}}
                                    {{if eq (len $prLinks) 1}}
                                        <a href="{{(index $prLinks 0).URL}}" target="_blank" class="indicator-badge indicator-link">üîó {{len $prLinks}}</a>
                                    {{else}}
                                        <div class="indicator-dropdown">
                                            <span class="indicator-badge indicator-dropdown-toggle" onclick="toggleIndicatorDropdown(this)">üîó {{len $prLinks}}</span>
                                            <div class="indicator-dropdown-menu">
                                                {{range $prLinks}}
                                                    <a href="{{.URL}}" target="_blank" class="indicator-dropdown-item">{{.Title}}</a>
                                                {{end}}
                                            </div>
                                        </div>
                                    {{end}}
                                {{end}}
                                {{if gt (len $slackLinks) 0}}
                                    {{if eq (len $slackLinks) 1}}
                                        <a href="{{(index $slackLinks 0).URL}}" target="_blank" class="indicator-badge indicator-link">üó®Ô∏è {{len $slackLinks}}</a>
                                    {{else}}
                                        <div class="indicator-dropdown">
                                            <span class="indicator-badge indicator-dropdown-toggle" onclick="toggleIndicatorDropdown(this)">üó®Ô∏è {{len $slackLinks}}</span>
                                            <div class="indicator-dropdown-menu">
                                                {{range $slackLinks}}
                                                    <a href="{{.URL}}" target="_blank" class="indicator-dropdown-item">{{.Title}}</a>
                                                {{end}}
                                            </div>
                                        </div>
                                    {{end}}
                                {{end}}
                                {{if gt (len $jiraLinks) 0}}
                                    {{if eq (len $jiraLinks) 1}}
                                        <a href="{{(index $jiraLinks 0).URL}}" target="_blank" class="indicator-badge indicator-link">üìã {{len $jiraLinks}}</a>
                                    {{else}}
                                        <div class="indicator-dropdown">
                                            <span class="indicator-badge indicator-dropdown-toggle" onclick="toggleIndicatorDropdown(this)">üìã {{len $jiraLinks}}</span>
                                            <div class="indicator-dropdown-menu">
                                                {{range $jiraLinks}}
                                                    <a href="{{.URL}}" target="_blank" class="indicator-dropdown-item">{{.Title}}</a>
                                                {{end}}
                                            </div>
                                        </div>
                                    {{end}}
                                {{end}}
                                {{if gt (len $docsLinks) 0}}
                                    {{if eq (len $docsLinks) 1}}
                                        <a href="{{(index $docsLinks 0).URL}}" target="_blank" class="indicator-badge indicator-link">üìö {{len $docsLinks}}</a>
                                    {{else}}
                                        <div class="indicator-dropdown">
                                            <span class="indicator-badge indicator-dropdown-toggle" onclick="toggleIndicatorDropdown(this)">üìö {{len $docsLinks}}</span>
                                            <div class="indicator-dropdown-menu">
                                                {{range $docsLinks}}
                                                    <a href="{{.URL}}" target="_blank" class="indicator-dropdown-item">{{.Title}}</a>
                                                {{end}}
                                            </div>
                                        </div>
                                    {{end}}
                                {{end}}
                                {{if gt (len $otherLinks) 0}}
                                    {{if eq (len $otherLinks) 1}}
                                        <a href="{{(index $otherLinks 0).URL}}" target="_blank" class="indicator-badge indicator-link">üåê {{len $otherLinks}}</a>
                                    {{else}}
                                        <div class="indicator-dropdown">
                                            <span class="indicator-badge indicator-dropdown-toggle" onclick="toggleIndicatorDropdown(this)">üåê {{len $otherLinks}}</span>
                                            <div class="indicator-dropdown-menu">
                                                {{range $otherLinks}}
                                                    <a href="{{.URL}}" target="_blank" class="indicator-dropdown-item">{{.Title}}</a>
                                                {{end}}
                                            </div>
                                        </div>
                                    {{end}}
                                {{end}}
                            </div>
                        </div>
                        {{if .Blockers}}
                        <div class="task-info-row">
                            <div class="task-links-section">
                                <span class="blockers-badge">‚ö†Ô∏è {{len .Blockers}} blocker{{if ne (len .Blockers) 1}}s{{end}}</span>
                            </div>
                        </div>
                        {{end}}
                        <div class="task-timestamps">
                            <span class="timestamp">üìÖ Created: {{.CreatedAt.Format "Jan 2, 2006"}}</span>
                            <span class="separator">|</span>
                            <span class="timestamp">üìù Updated: {{.UpdatedAt.Format "Jan 2, 15:04"}}</span>
                        </div>
                    </div>
                    <div class="task-status">
                        <select class="status-select" data-task-id="{{.ID}}" onchange="updateTaskStatus(this)">
                            <option value="new" {{if eq (string .Status) "new"}}selected{{end}}>üìù New</option>
                            <option value="in_progress" {{if eq (string .Status) "in_progress"}}selected{{end}}>üîÑ In Progress</option>
                            <option value="blocked" {{if eq (string .Status) "blocked"}}selected{{end}}>üö´ Blocked</option>
                            <option value="done" {{if eq (string .Status) "done"}}selected{{end}}>‚úÖ Done</option>
                            <option value="archived" {{if eq (string .Status) "archived"}}selected{{end}}>üì¶ Archived</option>
                        </select>
                    </div>
                </div>
                {{if .Blockers}}
                <div class="task-blockers">
                    <span class="blockers-label">‚ö†Ô∏è Blocked by:</span>
                    {{range $i, $blocker := .Blockers}}{{if $i}} ‚Ä¢ {{end}}{{$blocker}}{{end}}
                </div>
                {{end}}
            </div>
            {{end}}

            <!-- Pagination -->
            {{if .HasMore}}
            <div class="pagination">
                <button class="btn btn-secondary load-more-btn" onclick="loadMoreTasks()">
                    Load More...
                </button>
                <div class="pagination-info">
                    Showing {{.Offset}} - {{.CurrentCount}} of {{.TotalCount}} tasks
                </div>
            </div>
            {{end}}

        {{else}}
            <div class="empty-state">
                <div class="empty-icon">üìù</div>
                <h3>No tasks found</h3>
                <p>{{if .SearchQuery}}No tasks match your search criteria.{{else}}Get started by creating your first task!{{end}}</p>
                <button class="btn btn-primary" onclick="window.location.href='/new'">
                    ‚ûï Create First Task
                </button>
            </div>
        {{end}}
    </div>
</div>

<!-- Status Update Loading Indicator -->
<div id="status-loading" class="loading-indicator" style="display: none;">
    <div class="spinner"></div>
    Updating...
</div>

{{end}}