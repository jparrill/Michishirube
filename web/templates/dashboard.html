{{define "content"}}
<div class="dashboard">



    <!-- Tasks List -->
    <div class="tasks-container">
        {{if .Tasks}}
            {{range .Tasks}}
            <div class="task-card" data-task-id="{{.ID}}">
                <div class="task-header">
                    <div class="task-title">
                        <a href="/task/{{.ID}}" class="task-link">
                            <span class="jira-id">{{if ne .JiraID "NO-JIRA"}}[{{.JiraID}}]{{end}}</span>
                            <span class="title-text">{{.Title}}</span>
                        </a>
                    </div>
                    <div class="task-actions">
                        <div class="status-dropdown">
                            <select class="status-select" data-task-id="{{.ID}}" onchange="updateTaskStatus(this)">
                                <option value="new" {{if eq (string .Status) "new"}}selected{{end}}>ğŸ“ New</option>
                                <option value="in_progress" {{if eq (string .Status) "in_progress"}}selected{{end}}>ğŸ”„ In Progress</option>
                                <option value="blocked" {{if eq (string .Status) "blocked"}}selected{{end}}>ğŸš« Blocked</option>
                                <option value="done" {{if eq (string .Status) "done"}}selected{{end}}>âœ… Done</option>
                                <option value="archived" {{if eq (string .Status) "archived"}}selected{{end}}>ğŸ“¦ Archived</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="task-meta">
                    <div class="meta-row">
                        <span class="priority priority-{{string .Priority}}">
                            {{if eq (string .Priority) "critical"}}ğŸ”´ Critical{{end}}
                            {{if eq (string .Priority) "high"}}ğŸŸ¡ High{{end}}
                            {{if eq (string .Priority) "normal"}}ğŸŸ¢ Normal{{end}}
                            {{if eq (string .Priority) "minor"}}âšª Minor{{end}}
                        </span>
                        <span class="separator">|</span>
                        <span class="status status-{{string .Status}}">
                            {{if eq (string .Status) "new"}}ğŸ“ New{{end}}
                            {{if eq (string .Status) "in_progress"}}ğŸ”„ In Progress{{end}}
                            {{if eq (string .Status) "blocked"}}ğŸš« Blocked{{end}}
                            {{if eq (string .Status) "done"}}âœ… Done{{end}}
                            {{if eq (string .Status) "archived"}}ğŸ“¦ Archived{{end}}
                        </span>
                        {{if .Tags}}
                        <span class="separator">|</span>
                        <div class="tags">
                            ğŸ“‹ {{range $i, $tag := .Tags}}{{if $i}}, {{end}}<span class="tag">{{$tag}}</span>{{end}}
                        </div>
                        {{end}}
                    </div>

                    {{if .Links}}
                    <div class="meta-row">
                        <div class="links-summary">
                            {{range .Links}}
                                <span class="link-indicator">
                                    {{if eq .Type "pull_request"}}ğŸ”— PR{{end}}
                                    {{if eq .Type "slack_thread"}}ğŸ’¬ Slack{{end}}
                                    {{if eq .Type "jira_ticket"}}ğŸ“‹ Jira{{end}}
                                    {{if eq .Type "documentation"}}ğŸ“š Docs{{end}}
                                    {{if eq .Type "other"}}ğŸŒ Link{{end}}
                                    {{if .Status}}<small>({{.Status}})</small>{{end}}
                                </span>
                            {{end}}
                            {{if .Comments}}
                            <span class="comments-indicator">ğŸ’¬ {{len .Comments}} comment{{if ne (len .Comments) 1}}s{{end}}</span>
                            {{end}}
                        </div>
                    </div>
                    {{end}}

                    {{if .Blockers}}
                    <div class="meta-row blockers-row">
                        <div class="blockers">
                            <span class="blockers-label">âš ï¸ Blocked by:</span>
                            {{range $i, $blocker := .Blockers}}
                                {{if $i}} â€¢ {{end}}<span class="blocker">{{$blocker}}</span>
                            {{end}}
                        </div>
                    </div>
                    {{end}}

                    <div class="meta-row timestamps">
                        <span class="timestamp">ğŸ“… Created: <time class="relative-time" datetime="{{.CreatedAt.Format "2006-01-02T15:04:05Z"}}">{{.CreatedAt.Format "Jan 2, 2006"}}</time></span>
                        <span class="separator">|</span>
                        <span class="timestamp">ğŸ“ Updated: <time class="relative-time" datetime="{{.UpdatedAt.Format "2006-01-02T15:04:05Z"}}">{{.UpdatedAt.Format "Jan 2, 15:04"}}</time></span>
                    </div>
                </div>
            </div>
            {{end}}

            <!-- Pagination -->
            {{if .HasMore}}
            <div class="pagination">
                <button class="btn btn-secondary load-more-btn" onclick="loadMoreTasks()">
                    Load More...
                </button>
                <div class="pagination-info">
                    Showing {{.Offset}} - {{.CurrentCount}} of {{.TotalCount}} tasks
                </div>
            </div>
            {{end}}

        {{else}}
            <div class="empty-state">
                <div class="empty-icon">ğŸ“</div>
                <h3>No tasks found</h3>
                <p>{{if .SearchQuery}}No tasks match your search criteria.{{else}}Get started by creating your first task!{{end}}</p>
                <button class="btn btn-primary" onclick="window.location.href='/new'">
                    â• Create First Task
                </button>
            </div>
        {{end}}
    </div>
</div>

<!-- Status Update Loading Indicator -->
<div id="status-loading" class="loading-indicator" style="display: none;">
    <div class="spinner"></div>
    Updating...
</div>

{{end}}